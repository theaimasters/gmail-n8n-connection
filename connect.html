function connectGmail() {
  const fullname = document.getElementById('fullname').value.trim();
  const company = document.getElementById('company').value.trim();
  const scope = document.getElementById('scope').value;
  
  if (!fullname || !company) {
    alert("Please fill in your name and company.");
    return;
  }
  
  // n8n EXPECTS: {"cid": "UEwqJ7Vv1srVQRXL"}
  const rawState = JSON.stringify({ 
    cid: "UEwqJ7Vv1srVQRXL"
  });
  
  // Base64 encode
  const state = btoa(rawState);
  
  // CRITICAL: Build URL manually to avoid double-encoding
  const authUrl = "https://accounts.google.com/o/oauth2/v2/auth" +
    "?client_id=139836157120-v0cb002ub2gvq0q50mca0568h9q8abtj.apps.googleusercontent.com" +
    "&redirect_uri=" + encodeURIComponent("https://n8nscalera.eu/rest/oauth2-credential/callback") +
    "&response_type=code" +
    "&access_type=offline" +
    "&prompt=consent" +
    "&scope=" + encodeURIComponent(scope) +
    "&state=" + state;  // Don't encode state - let Google handle it
  
  window.location.href = authUrl;
}
